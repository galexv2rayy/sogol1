<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ø³ÙˆÚ¯Ù„ ğŸ‰ 3D Surprize</title>
<style>
body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#111;font-family:'Vazirmatn',sans-serif;}
#overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fff;text-align:center;}
h1{font-size:3rem;margin:0 0 10px;text-shadow:0 0 15px #ff4d6d;}
p{font-size:1.4rem;margin:0 0 20px;color:#ffd76b;text-shadow:0 0 12px #ffd76b;}
button{padding:14px 28px;font-size:1.2rem;font-weight:700;background:linear-gradient(90deg,#ff6b6b,#ffb86b);border:none;border-radius:16px;cursor:pointer;color:#111;box-shadow:0 6px 20px rgba(255,107,107,0.3);}
</style>
</head>
<body>

<div id="overlay">
  <h1>Ø³ÙˆÚ¯Ù„ ğŸ‰</h1>
  <p>ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú©! â¤ï¸ Ù„Ù…Ø³ Ú©Ù† ØªØ§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…</p>
  <button id="startBtn">Ø´Ø±ÙˆØ¹ 3D ğŸ‰</button>
</div>

<audio id="song" preload="auto"><source src="music.mp3" type="audio/mpeg"></audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
<script>
// ØµØ­Ù†Ù‡ØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ renderer
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,2000);
camera.position.set(0,0,100);

const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setClearColor(0x111111,1);
document.body.appendChild(renderer.domElement);

// Ù†ÙˆØ±Ù¾Ø±Ø¯Ø§Ø²ÛŒ
const ambientLight=new THREE.AmbientLight(0xffffff,0.6);
scene.add(ambientLight);
const directionalLight=new THREE.DirectionalLight(0xff6b6b,0.8);
directionalLight.position.set(100,200,100);
scene.add(directionalLight);

// Ú©Ù†ØªØ±Ù„ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¨Ø±Ø§ÛŒ ØªØ³Øª (ØºÛŒØ± ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¨Ø±Ø§ÛŒ ØªØ¬Ø±Ø¨Ù‡ Ù†Ù‡Ø§ÛŒÛŒ)
const controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableZoom=false;
controls.enablePan=false;
controls.enableRotate=false;

// Ø§Ù†Ø¯Ø§Ø²Ù‡ ØµÙØ­Ù‡ responsive
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});

// Ø¢Ø±Ø§ÛŒÙ‡ Ù‚Ù„Ø¨â€ŒÙ‡Ø§ Ùˆ particleâ€ŒÙ‡Ø§
const hearts=[];
const particles=[];
<script>
// Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ù‡Ù†Ø¯Ø³Ù‡ Ù‚Ù„Ø¨ 3D Ø³Ø§Ø¯Ù‡ Ø¨Ø§ LatheGeometry
function createHeart(size=5){
  const points=[];
  for(let t=0;t<Math.PI*2;t+=0.1){
    const x=16*Math.pow(Math.sin(t),3);
    const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
    points.push(new THREE.Vector2(x*size*0.05,y*size*0.05));
  }
  const geometry=new THREE.LatheGeometry(points,32);
  const material=new THREE.MeshStandardMaterial({
    color:0xff4d6d,
    metalness:0.4,
    roughness:0.3,
    emissive:0xff4d6d,
    emissiveIntensity:0.5
  });
  const mesh=new THREE.Mesh(geometry,material);
  return mesh;
}

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† 12 Ù‚Ù„Ø¨ Ø¨Ù‡ ØµØ­Ù†Ù‡
for(let i=0;i<12;i++){
  const h=createHeart(5+Math.random()*3);
  h.position.set((Math.random()-0.5)*100,(Math.random()-0.5)*60,(Math.random()-0.5)*50);
  h.rotation.set(Math.random()*0.5,Math.random()*0.5,Math.random()*0.5);
  scene.add(h);
  hearts.push({mesh:h,vx:(Math.random()-0.5)*0.5,vy:(Math.random()-0.5)*0.5,vz:(Math.random()-0.5)*0.5});
}

// Ø±Ù†Ø¯Ø± loop Ø¨Ø§ Ø­Ø±Ú©Øª Ø´Ù†Ø§ÙˆØ± Ùˆ rotation
function animate(){
  requestAnimationFrame(animate);

  hearts.forEach(h=>{
    h.mesh.position.x+=h.vx;
    h.mesh.position.y+=h.vy;
    h.mesh.position.z+=h.vz;
    h.mesh.rotation.x+=0.01;
    h.mesh.rotation.y+=0.01;

    // bounce Ø¨ÛŒÙ† Ù…Ø­Ø¯ÙˆØ¯Ù‡
    if(h.mesh.position.x>50||h.mesh.position.x<-50) h.vx*=-1;
    if(h.mesh.position.y>50||h.mesh.position.y<-50) h.vy*=-1;
    if(h.mesh.position.z>50||h.mesh.position.z<-50) h.vz*=-1;
  });

  // Ø±Ù†Ø¯Ø± particle Ù‡Ø§
  particles.forEach((p,i)=>{
    p.life-=0.02;
    if(p.life<=0){ scene.remove(p.mesh); particles.splice(i,1);}
    else{
      p.mesh.position.add(p.vel);
      p.mesh.material.opacity=p.life;
    }
  });

  renderer.render(scene,camera);
}
animate();

// Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù‚Ù„Ø¨â€ŒÙ‡Ø§
renderer.domElement.addEventListener('pointerdown',(event)=>{
  const mouse=new THREE.Vector2();
  mouse.x=(event.clientX/window.innerWidth)*2-1;
  mouse.y=-(event.clientY/window.innerHeight)*2+1;
  const raycaster=new THREE.Raycaster();
  raycaster.setFromCamera(mouse,camera);
  const intersects=raycaster.intersectObjects(hearts.map(h=>h.mesh));
  intersects.forEach(i=>{
    // particle burst
    for(let j=0;j<20;j++){
      const geom=new THREE.SphereGeometry(0.5,6,6);
      const mat=new THREE.MeshStandardMaterial({color:0xffff00,emissive:0xffff00,transparent:true,opacity:1});
      const m=new THREE.Mesh(geom,mat);
      m.position.copy(i.object.position);
      scene.add(m);
      const vel=new THREE.Vector3((Math.random()-0.5)*0.5,(Math.random()-0.5)*0.5,(Math.random()-0.5)*0.5);
      particles.push({mesh:m,vel:vel,life:1});
    }
    // Ø­Ø°Ù Ù‚Ù„Ø¨
    const index=hearts.findIndex(h=>h.mesh===i.object);
    if(index>-1){ scene.remove(hearts[index].mesh); hearts.splice(index,1);}
  });
});
<script>
// Ø¨Ø§Ù„ÙˆÙ†â€ŒÙ‡Ø§ÛŒ 3D
const balloons=[];
function spawnBalloons3D(count=10){
  for(let i=0;i<count;i++){
    const geom=new THREE.CylinderGeometry(3,4,10,12);
    const mat=new THREE.MeshStandardMaterial({color:Math.random()*0xffffff,emissive:0xffd76b,metalness:0.3,roughness:0.4});
    const balloon=new THREE.Mesh(geom,mat);
    balloon.position.set((Math.random()-0.5)*100,-60,(Math.random()-0.5)*50);
    scene.add(balloon);
    balloons.push({mesh:balloon,vx:0,vy:0.3+Math.random()*0.2});
  }
}

// Ø­Ø±Ú©Øª Ø¨Ø§Ù„ÙˆÙ†â€ŒÙ‡Ø§
function animateBalloons(){
  balloons.forEach(b=>{
    b.mesh.position.y+=b.vy;
    b.mesh.position.x+=Math.sin(Date.now()/500)*0.05;
    if(b.mesh.position.y>60) b.mesh.position.y=-60;
  });
}

// Ú©Ù†ÙØªÛŒ 3D
const confetti3D=[];
function spawnConfetti3D(count=100){
  for(let i=0;i<count;i++){
    const geom=new THREE.BoxGeometry(0.5,0.5,0.2);
    const mat=new THREE.MeshStandardMaterial({color:Math.random()*0xffffff,emissive:Math.random()*0xffffff});
    const cube=new THREE.Mesh(geom,mat);
    cube.position.set((Math.random()-0.5)*100,50+(Math.random()*50),(Math.random()-0.5)*50);
    const vel=new THREE.Vector3((Math.random()-0.5)*0.5,-Math.random()*1.5,(Math.random()-0.5)*0.5);
    scene.add(cube);
    confetti3D.push({mesh:cube,vel:vel});
  }
}

// Ø­Ø±Ú©Øª Ú©Ù†ÙØªÛŒ
function animateConfetti(){
  confetti3D.forEach((c,i)=>{
    c.mesh.position.add(c.vel);
    c.vel.y-=0.01; // gravity
    if(c.mesh.position.y<-60){ scene.remove(c.mesh); confetti3D.splice(i,1);}
  });
}

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÙÚ©Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ø±Ù†Ø¯Ø± loop
const originalAnimate=animate;
animate=function(){
  requestAnimationFrame(animate);
  hearts.forEach(h=>{
    h.mesh.position.x+=h.vx; h.mesh.position.y+=h.vy; h.mesh.position.z+=h.vz;
    h.mesh.rotation.x+=0.01; h.mesh.rotation.y+=0.01;
    if(h.mesh.position.x>50||h.mesh.position.x<-50) h.vx*=-1;
    if(h.mesh.position.y>50||h.mesh.position.y<-50) h.vy*=-1;
    if(h.mesh.position.z>50||h.mesh.position.z<-50) h.vz*=-1;
  });
  particles.forEach((p,i)=>{
    p.life-=0.02;
    if(p.life<=0){ scene.remove(p.mesh); particles.splice(i,1);}
    else{ p.mesh.position.add(p.vel); p.mesh.material.opacity=p.life;}
  });
  animateBalloons();
  animateConfetti();
  originalAnimate();
};
animate();

// ØªØ§ÛŒÙ¾ Ù¾ÛŒØ§Ù… Ø¹Ø§Ø´Ù‚Ø§Ù†Ù‡ Ø±ÙˆÛŒ ØµÙØ­Ù‡
const overlay=document.getElementById('overlay');
function typeMessage3D(message,delay=50){
  overlay.innerHTML="<h1>"+RECIPIENT+"</h1><p id='typedMsg'></p>";
  const typedMsg=document.getElementById('typedMsg');
  typedMsg.textContent="";
  let i=0;
  const t=setInterval(()=>{
    typedMsg.textContent+=message[i++];
    if(i>=message.length){ clearInterval(t);}
  },delay);
}

// Ø´Ø±ÙˆØ¹ Ù†Ù‡Ø§ÛŒÛŒ WebGL
startBtn.addEventListener('click',()=>{
  overlay.style.display='none';
  song.play().catch(()=>{});
  spawnBalloons3D(12);
  spawnConfetti3D(200);
  typeMessage3D("Ø³ÙˆÚ¯Ù„ Ø¬ÙˆÙ†Ù… ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú© â¤ï¸ ØªÙˆÛŒÛŒ Ù…Ù† ğŸ’– Ø¨Ø¨Ø®Ø´ÛŒØ¯ Ù†Ø§Ø±Ø§Ø­ØªØª Ú©Ø±Ø¯Ù… Ø¹Ø²ÛŒØ²Ù‡ Ø¯Ù„Ù…");
});
</script>
  spawnConfetti3D(200);
  typeMessage3D("Ø³ÙˆÚ¯Ù„ Ø¬ÙˆÙ†Ù… ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú© â¤ï¸ ØªÙˆÛŒÛŒ Ù…Ù† ğŸ’– Ø¨Ø¨Ø®Ø´ÛŒØ¯ Ù†Ø§Ø±Ø§Ø­ØªØª Ú©Ø±Ø¯Ù… Ø¹Ø²ÛŒØ²Ù‡ Ø¯Ù„Ù…");
});
</script>
</body>
</html>
