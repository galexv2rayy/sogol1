<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú© Ø³ÙˆÚ¯Ù„ ðŸ’–</title>
<style>
body, html{margin:0;padding:0;height:100%;overflow:hidden;font-family:"Vazirmatn",sans-serif;background:#111;}
#stage{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;color:#fff;transition:all 0.3s;}
.card{background:rgba(0,0,0,0.35);padding:30px 40px;border-radius:20px;text-align:center;backdrop-filter:blur(6px);box-shadow:0 10px 25px rgba(0,0,0,0.7);transition:all 0.5s;}
h1{font-size:2.2rem;margin:0;animation:fadeIn 1s ease;}
.name{font-size:2.6rem;font-weight:800;color:#ffcc00;margin:10px 0;animation:fadeIn 1.2s ease;}
p{margin:8px 0 15px;color:#cfd8e3a8;animation:fadeIn 1.4s ease;}
.btn{padding:12px 20px;border:none;border-radius:12px;font-weight:700;background:linear-gradient(90deg,#ffb86b,#ff6b6b);cursor:pointer;color:#111;font-size:1rem;box-shadow:0 6px 18px rgba(255,107,107,0.18);transition:all 0.3s;}
.btn:hover{transform:scale(1.05);}
#confetti, #gameCanvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:50;}
.balloon{position:absolute;bottom:-200px;width:70px;height:100px;border-radius:60px 60px 40px 40px/70px 70px 40px 40px;transform-origin:center bottom;animation:floatUp linear infinite;opacity:0.95;display:flex;align-items:flex-end;justify-content:center;}
.string{width:2px;height:60px;background:rgba(255,255,255,0.12);margin-bottom:-20px;border-radius:2px;}
@keyframes floatUp{0%{transform:translateY(0) rotate(-4deg);}50%{transform:translateY(-10px) rotate(4deg);}100%{transform:translateY(-130vh) rotate(-4deg);}}
.typed{display:inline-block;border-right:3px solid #fff;padding-right:6px;}
#score{position:absolute;top:15px;left:15px;font-size:1.4rem;font-weight:bold;color:#fff;z-index:51;}
@keyframes fadeIn{0%{opacity:0;transform:translateY(10px);}100%{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>

<canvas id="confetti"></canvas>
<canvas id="gameCanvas"></canvas>

<div id="score">Ù‡Ø¯Ø§ÛŒØ§ Ø¬Ù…Ø¹ Ø´Ø¯Ù‡: 0</div>

<div id="stage">
  <div class="card" id="card">
    <h1>ÛŒÙ‡ Ø³ÙˆØ±Ù¾Ø±Ø§ÛŒØ² Ø¨Ø±Ø§ÛŒ Ø³ÙˆÚ¯Ù„ ðŸ’–</h1>
    <div class="name" id="typedText"><span class="typed">Ø³ÙˆÚ¯Ù„</span></div>
    <p id="msg">Ù„Ù…Ø³ Ú©Ù† ØªØ§ Ø´Ø±ÙˆØ¹ Ú©Ù†Ù… ðŸŽ‰</p>
    <button class="btn" id="startBtn">Ø³ÙˆØ±Ù¾Ø±Ø§ÛŒØ² Ú©Ù† ðŸŽ‰</button>
  </div>
</div>

<audio id="song" preload="auto">
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
const RECIPIENT="Ø³ÙˆÚ¯Ù„ ðŸ’–";
const MESSAGE="Ø³ÙˆÚ¯Ù„ Ø¬ÙˆÙ†Ù… ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú© â¤ï¸ ØªÙˆÛŒÛŒ Ù…Ù† ðŸ’– Ø¨Ø¨Ø®Ø´ÛŒØ¯ Ù†Ø§Ø±Ø§Ø­ØªØª Ú©Ø±Ø¯Ù… Ø¹Ø²ÛŒØ²Ù‡ Ø¯Ù„Ù…";

const startBtn=document.getElementById('startBtn');
const song=document.getElementById('song');
const nameDisplay=document.getElementById('typedText');
const msgP=document.getElementById('msg');
const confettiCanvas=document.getElementById('confetti');
const gameCanvas=document.getElementById('gameCanvas');
const card=document.getElementById('card');
const scoreDiv=document.getElementById('score');

let score=0;
const gifts=[];
const ctx=gameCanvas.getContext('2d');

function typeText(el,text,delay=80){
  el.textContent="";
  return new Promise(res=>{
    let i=0;
    const t=setInterval(()=>{
      el.textContent+=text[i++];
      if(i>=text.length){ clearInterval(t); el.classList.remove('typed'); res();}
    },delay);
  });
}

function spawnBalloons(){
  const colors=["#ff7eb9","#7afcff","#ffd86b","#b28dff","#ff8a65"];
  for(let i=0;i<8;i++){
    const b=document.createElement('div');
    b.className='balloon';
    b.style.left=(5+Math.random()*90)+"%";
    b.style.width=(60+Math.random()*60)+"px";
    b.style.height=(80+Math.random()*80)+"px";
    b.style.background=colors[Math.floor(Math.random()*colors.length)];
    b.style.animationDuration=(12+Math.random()*8)+"s";
    b.innerHTML='<div class="string"></div>';
    document.body.appendChild(b);
    setTimeout(()=>b.remove(),30000);
  }
}

function startConfetti(){
  const ctx=confettiCanvas.getContext('2d');
  confettiCanvas.width=innerWidth;
  confettiCanvas.height=innerHeight;
  const pieces=[];
  const colors=["#ff6b6b","#ffd76b","#7afcff","#b28dff","#ffffff"];
  for(let i=0;i<160;i++){
    pieces.push({
      x:Math.random()*confettiCanvas.width,
      y:Math.random()*confettiCanvas.height-confettiCanvas.height,
      w:6+Math.random()*8,
      h:8+Math.random()*10,
      vx:-2+Math.random()*4,
      vy:2+Math.random()*6,
      c:colors[Math.floor(Math.random()*colors.length)],
      rot:Math.random()*360,
      rotspeed:-5+Math.random()*10
    });
  }
  let raf;
  function frame(){
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    for(const p of pieces){
      p.x+=p.vx; p.y+=p.vy; p.rot+=p.rotspeed;
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot*Math.PI/180);
      ctx.fillStyle=p.c;
      ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
      ctx.restore();
      if(p.y>confettiCanvas.height+40){p.y=-20;p.x=Math.random()*confettiCanvas.width;}
    }
    raf=requestAnimationFrame(frame);
  }
  frame();
  setTimeout(()=>cancelAnimationFrame(raf),30000);
}

function goFullscreen(){
  const el=document.documentElement;
  if(el.requestFullscreen)el.requestFullscreen().catch(()=>{});
  else if(el.webkitRequestFullscreen)el.webkitRequestFullscreen();
}

function drawHeart(ctx,x,y,size){
  ctx.save();
  ctx.translate(x,y);
  ctx.beginPath();
  const topCurveHeight=size*0.3;
  ctx.moveTo(0, topCurveHeight);
  ctx.bezierCurveTo(0,-size*0.35, -size,-size*0.35, -size,topCurveHeight);
  ctx.bezierCurveTo(-size,size*0.6, 0,size*0.9,0,size);
  ctx.bezierCurveTo(0,size*0.9, size,size*0.6, size,topCurveHeight);
  ctx.bezierCurveTo(size,-size*0.35,0,-size*0.35,0,topCurveHeight);
  ctx.closePath();
  ctx.fillStyle="#ff4d6d";
  ctx.fill();
  ctx.fillStyle="#fff";
  ctx.font=`${size/3}px Vazirmatn`;
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText("Ø³ÙˆÚ¯Ù„",0,size*0.15);
  ctx.restore();
}

function drawGame(){
  ctx.clearRect(0,0,gameCanvas.width,gameCanvas.height);
  gifts.forEach(g=>{
    drawHeart(ctx,g.x,g.y,g.size);
  });
}

function startGame(){
  gameCanvas.width=window.innerWidth;
  gameCanvas.height=window.innerHeight;
  score=0;
  gifts.length=0;
  scoreDiv.textContent="Ù‡Ø¯Ø§ÛŒØ§ Ø¬Ù…Ø¹ Ø´Ø¯Ù‡: 0";
  
  for(let i=0;i<10;i++){
    gifts.push({
      x:Math.random()*gameCanvas.width,
      y:Math.random()*gameCanvas.height,
      size:40 + Math.random()*20
    });
  }

  drawGame();
  gameCanvas.style.pointerEvents='auto';
  gameCanvas.addEventListener('click',clickHandler);
}

function clickHandler(e){
  const rect=gameCanvas.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  for(let i=gifts.length-1;i>=0;i--){
    const g=gifts[i];
    if(Math.sqrt((x-g.x)*(x-g.x) + (y-g.y)*(y-g.y)) < g.size*0.7){
      gifts.splice(i,1);
      score++;
      scoreDiv.textContent="Ù‡Ø¯Ø§ÛŒØ§ Ø¬Ù…Ø¹ Ø´Ø¯Ù‡: "+score;
      if(score>=10){
        gameCanvas.removeEventListener('click',clickHandler);
        gameCanvas.style.pointerEvents='none';
        startSequence();
      }
    }
  }
  drawGame();
}

async function startSequence(){
  startBtn.disabled=true;
  startBtn.textContent="Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...";

  goFullscreen();
  card.animate([{transform:'scale(0.95)'},{transform:'scale(1)'}],{duration:500,easing:'ease-out'});

  // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù¾Ù„ÛŒ Ù…ÙˆØ²ÛŒÚ©ØŒ Ø§Ú¯Ø± iOS Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡
  try{
    await song.play();
  }catch(e){
    console.warn("iOS autoplay blocked, Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ²ÛŒÚ©", e);
  }

  spawnBalloons();
  startConfetti();

  nameDisplay.textContent=""; nameDisplay.classList.add('typed');
  await typeText(nameDisplay,RECIPIENT,120);
  msgP.textContent="";
  await typeText(msgP,MESSAGE,55);

  startBtn.textContent="Ø¯ÙˆØ¨Ø§Ø±Ù‡ ðŸŽ‰"; startBtn.disabled=false;
}

startBtn.addEventListener('click',()=>{
  startGame();
});
</script>
</body>
</html>
